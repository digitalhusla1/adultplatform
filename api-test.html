<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Health Check - HD Porn Love</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #ff6b9d;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 10px 20px;
            background: #ff6b9d;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        button:hover {
            background: #ff5088;
        }

        button:disabled {
            background: #999;
            cursor: not-allowed;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: #2d2d2d;
            border-left: 4px solid #999;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .status-card.success {
            border-left-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }

        .status-card.error {
            border-left-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }

        .status-card.loading {
            border-left-color: #2196f3;
            background: rgba(33, 150, 243, 0.1);
        }

        .status-card h3 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-icon {
            font-size: 20px;
        }

        .status-message {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 10px;
        }

        .status-details {
            font-size: 12px;
            color: #999;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 3px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: #2d2d2d;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .results-table th,
        .results-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        .results-table th {
            background: #1e1e1e;
            color: #ff6b9d;
            font-weight: bold;
        }

        .results-table tbody tr:hover {
            background: #3d3d3d;
        }

        .results-table .status-ok {
            color: #4caf50;
        }

        .results-table .status-error {
            color: #f44336;
        }

        .results-table .status-pending {
            color: #2196f3;
        }

        .summary {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid #ff6b9d;
        }

        .summary h2 {
            margin-bottom: 15px;
            color: #ff6b9d;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #444;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #999;
            border-top: 2px solid #ff6b9d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .scroll-container {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Eporner API Health Check</h1>

        <div class="controls">
            <button id="testAllBtn" onclick="testAllPages()">Test All Pages</button>
            <button id="testCategoriesBtn" onclick="testCategories()">Test Categories</button>
            <button id="testRemovalsBtn" onclick="testRemovedVideos()">Test Removals</button>
            <button id="clearBtn" onclick="clearResults()">Clear Results</button>
        </div>

        <div id="statusContainer" class="status-grid"></div>

        <div id="resultsContainer" class="scroll-container">
            <table class="results-table" id="resultsTable" style="display:none">
                <thead>
                    <tr>
                        <th>Page/Query</th>
                        <th>Status</th>
                        <th>Videos Found</th>
                        <th>Total Pages</th>
                        <th>Response Time</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody id="resultsBody"></tbody>
            </table>
        </div>

        <div id="summaryContainer"></div>
    </div>

    <script>
        const API_BASE_URL = 'https://www.eporner.com/api/v2';
        const API_TIMEOUT = 10000;
        const MAX_RETRIES = 1;

        const pages = [
            { name: 'Home (All)', query: 'all', type: 'home' },
            { name: 'Latest', query: 'all', order: 'latest', type: 'category' },
            { name: 'Popular', query: 'all', order: 'most-popular', type: 'category' },
            { name: 'Top Weekly', query: 'all', order: 'top-weekly', type: 'category' },
            { name: 'Top Monthly', query: 'all', order: 'top-monthly', type: 'category' },
            { name: 'Teen', query: 'teen', type: 'category' },
            { name: 'MILF', query: 'milf', type: 'category' },
            { name: 'Asian', query: 'asian', type: 'category' },
            { name: 'Amateur', query: 'amateur', type: 'category' },
            { name: 'Anal', query: 'anal', type: 'category' },
            { name: 'Ebony', query: 'ebony', type: 'category' },
            { name: 'Lesbian', query: 'lesbian', type: 'category' },
            { name: 'Creampie', query: 'creampie', type: 'category' },
            { name: 'Outdoor', query: 'outdoor', type: 'category' },
            { name: 'Mature', query: 'mature', type: 'category' },
            { name: 'Hentai', query: 'hentai', type: 'category' },
            { name: 'Threesome', query: 'threesome', type: 'category' }
        ];

        let results = [];
        let testInProgress = false;

        async function fetchWithTimeout(url, timeout = API_TIMEOUT) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);

            try {
                const response = await fetch(url, {
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                clearTimeout(timeoutId);
                throw error;
            }
        }

        async function testPage(page) {
            const startTime = Date.now();
            const params = new URLSearchParams({
                query: page.query,
                per_page: 12,
                page: 1,
                thumbsize: 'medium',
                order: page.order || 'most-popular',
                gay: 0,
                format: 'json'
            });

            try {
                const data = await fetchWithTimeout(
                    `${API_BASE_URL}/video/search/?${params}`,
                    API_TIMEOUT
                );

                const responseTime = Date.now() - startTime;

                const result = {
                    name: page.name,
                    status: 'success',
                    videosFound: data.videos?.length || 0,
                    totalPages: data.total_pages || 0,
                    totalCount: data.total_count || 0,
                    responseTime: responseTime,
                    details: `Videos: ${data.videos?.length || 0}, Total: ${data.total_count || 0}`
                };

                return result;
            } catch (error) {
                const responseTime = Date.now() - startTime;

                const result = {
                    name: page.name,
                    status: 'error',
                    videosFound: 0,
                    totalPages: 0,
                    totalCount: 0,
                    responseTime: responseTime,
                    details: error.message
                };

                return result;
            }
        }

        async function testAllPages() {
            if (testInProgress) return;
            testInProgress = true;

            document.getElementById('testAllBtn').disabled = true;
            document.getElementById('testCategoriesBtn').disabled = true;
            document.getElementById('testRemovalsBtn').disabled = true;

            results = [];
            displayResults();

            const statusContainer = document.getElementById('statusContainer');
            statusContainer.innerHTML = '';

            for (let i = 0; i < pages.length; i++) {
                const page = pages[i];
                const card = document.createElement('div');
                card.className = 'status-card loading';
                card.id = `status-${page.name.replace(/\s+/g, '-')}`;
                card.innerHTML = `
                    <h3>
                        <span class="spinner"></span>
                        ${page.name}
                    </h3>
                    <div class="status-message">Testing...</div>
                `;
                statusContainer.appendChild(card);

                const result = await testPage(page);
                results.push(result);

                const statusIcon = result.status === 'success' ? '‚úÖ' : '‚ùå';
                const statusClass = result.status;

                card.className = `status-card ${statusClass}`;
                card.innerHTML = `
                    <h3>
                        <span class="status-icon">${statusIcon}</span>
                        ${page.name}
                    </h3>
                    <div class="status-message">${result.details}</div>
                    <div class="status-details">
                        Response Time: ${result.responseTime}ms<br>
                        Videos Found: ${result.videosFound}<br>
                        Total Pages: ${result.totalPages}
                    </div>
                `;

                // Add small delay to avoid rate limiting
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            displayResults();
            displaySummary();

            testInProgress = false;
            document.getElementById('testAllBtn').disabled = false;
            document.getElementById('testCategoriesBtn').disabled = false;
            document.getElementById('testRemovalsBtn').disabled = false;
        }

        async function testCategories() {
            if (testInProgress) return;
            testInProgress = true;

            document.getElementById('testAllBtn').disabled = true;
            document.getElementById('testCategoriesBtn').disabled = true;
            document.getElementById('testRemovalsBtn').disabled = true;

            results = [];
            displayResults();

            const statusContainer = document.getElementById('statusContainer');
            statusContainer.innerHTML = '';

            const categoryPages = pages.filter(p => p.type === 'category');

            for (let i = 0; i < categoryPages.length; i++) {
                const page = categoryPages[i];
                const card = document.createElement('div');
                card.className = 'status-card loading';
                card.id = `status-${page.name.replace(/\s+/g, '-')}`;
                card.innerHTML = `
                    <h3>
                        <span class="spinner"></span>
                        ${page.name}
                    </h3>
                    <div class="status-message">Testing...</div>
                `;
                statusContainer.appendChild(card);

                const result = await testPage(page);
                results.push(result);

                const statusIcon = result.status === 'success' ? '‚úÖ' : '‚ùå';
                const statusClass = result.status;

                card.className = `status-card ${statusClass}`;
                card.innerHTML = `
                    <h3>
                        <span class="status-icon">${statusIcon}</span>
                        ${page.name}
                    </h3>
                    <div class="status-message">${result.details}</div>
                    <div class="status-details">
                        Response Time: ${result.responseTime}ms<br>
                        Videos Found: ${result.videosFound}<br>
                        Total Pages: ${result.totalPages}
                    </div>
                `;

                await new Promise(resolve => setTimeout(resolve, 500));
            }

            displayResults();
            displaySummary();

            testInProgress = false;
            document.getElementById('testAllBtn').disabled = false;
            document.getElementById('testCategoriesBtn').disabled = false;
            document.getElementById('testRemovalsBtn').disabled = false;
        }

        async function testRemovedVideos() {
            if (testInProgress) return;
            testInProgress = true;

            const statusContainer = document.getElementById('statusContainer');
            statusContainer.innerHTML = '';

            const card = document.createElement('div');
            card.className = 'status-card loading';
            card.innerHTML = `
                <h3>
                    <span class="spinner"></span>
                    Removed Videos Check
                </h3>
                <div class="status-message">Fetching removed videos list...</div>
            `;
            statusContainer.appendChild(card);

            const startTime = Date.now();

            try {
                const data = await fetchWithTimeout(
                    `${API_BASE_URL}/video/removed/?format=json`,
                    API_TIMEOUT
                );

                const responseTime = Date.now() - startTime;
                const removedCount = data?.length || 0;

                const result = {
                    name: 'Removed Videos',
                    status: 'success',
                    videosFound: removedCount,
                    totalPages: 0,
                    responseTime: responseTime,
                    details: `Total removed videos: ${removedCount}`
                };

                results = [result];

                card.className = 'status-card success';
                card.innerHTML = `
                    <h3>
                        <span class="status-icon">‚úÖ</span>
                        Removed Videos Check
                    </h3>
                    <div class="status-message">${result.details}</div>
                    <div class="status-details">
                        Response Time: ${result.responseTime}ms<br>
                        Total Removed: ${removedCount}
                    </div>
                `;
            } catch (error) {
                const responseTime = Date.now() - startTime;

                const result = {
                    name: 'Removed Videos',
                    status: 'error',
                    videosFound: 0,
                    totalPages: 0,
                    responseTime: responseTime,
                    details: error.message
                };

                results = [result];

                card.className = 'status-card error';
                card.innerHTML = `
                    <h3>
                        <span class="status-icon">‚ùå</span>
                        Removed Videos Check
                    </h3>
                    <div class="status-message">${result.details}</div>
                    <div class="status-details">
                        Response Time: ${result.responseTime}ms
                    </div>
                `;
            }

            displayResults();
            displaySummary();
            testInProgress = false;
        }

        function displayResults() {
            const resultsBody = document.getElementById('resultsBody');
            const resultsTable = document.getElementById('resultsTable');

            resultsBody.innerHTML = '';

            if (results.length === 0) {
                resultsTable.style.display = 'none';
                return;
            }

            results.forEach(result => {
                const row = document.createElement('tr');
                const statusClass = result.status === 'success' ? 'status-ok' : 'status-error';
                const statusText = result.status === 'success' ? 'OK' : 'ERROR';

                row.innerHTML = `
                    <td>${result.name}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>${result.videosFound}</td>
                    <td>${result.totalPages}</td>
                    <td>${result.responseTime}ms</td>
                    <td>${result.details}</td>
                `;

                resultsBody.appendChild(row);
            });

            resultsTable.style.display = 'table';
        }

        function displaySummary() {
            const summaryContainer = document.getElementById('summaryContainer');

            const successful = results.filter(r => r.status === 'success').length;
            const failed = results.filter(r => r.status === 'error').length;
            const totalVideos = results.reduce((sum, r) => sum + r.videosFound, 0);
            const avgResponseTime = results.length > 0
                ? Math.round(results.reduce((sum, r) => sum + r.responseTime, 0) / results.length)
                : 0;

            const summaryHTML = `
                <div class="summary">
                    <h2>üìä Test Summary</h2>
                    <div class="summary-item">
                        <span>Total Tests:</span>
                        <strong>${results.length}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Successful:</span>
                        <strong style="color: #4caf50;">${successful}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Failed:</span>
                        <strong style="color: #f44336;">${failed}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Success Rate:</span>
                        <strong>${results.length > 0 ? ((successful / results.length) * 100).toFixed(1) : 0}%</strong>
                    </div>
                    <div class="summary-item">
                        <span>Total Videos Found:</span>
                        <strong>${totalVideos.toLocaleString()}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Average Response Time:</span>
                        <strong>${avgResponseTime}ms</strong>
                    </div>
                </div>
            `;

            summaryContainer.innerHTML = summaryHTML;
        }

        function clearResults() {
            results = [];
            document.getElementById('statusContainer').innerHTML = '';
            document.getElementById('resultsTable').style.display = 'none';
            document.getElementById('resultsBody').innerHTML = '';
            document.getElementById('summaryContainer').innerHTML = '';
        }
    </script>
</body>
</html>
